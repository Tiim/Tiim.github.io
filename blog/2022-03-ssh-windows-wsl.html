<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="/swim-emoji.png" />
    <link rel="manifest" href="/manifest.json" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="alternate"
      type="application/rss+xml"
      title="tiim.ch Â» Tim Bachmann"
      href="/blog/rss.xml"
    />
    <link href="https://comments.tiim.ch/wm/webmentions" rel="webmention" />
    <link
      href="https://comments.tiim.ch/indieauth/metadata"
      rel="indieauth-metadata"
    />
    <link
      href="https://comments.tiim.ch/indieauth/authorize"
      rel="authorization_endpoint"
    />
    <link
      href="https://comments.tiim.ch/indieauth/token"
      rel="token_endpoint"
    />
    <link rel="micropub" href="https://comments.tiim.ch/micropub" />
    <link rel="microsub" href="https://aperture.p3k.io/microsub/801" />
    <title>Tim Bachmann</title>
    
		<link href="../_app/immutable/assets/0.8d503a92.css" rel="stylesheet">
		<link href="../_app/immutable/assets/4.32b0d823.css" rel="stylesheet">
		<link href="../_app/immutable/assets/MarkdownSite.52351ed7.css" rel="stylesheet">
		<link rel="modulepreload" href="../_app/immutable/entry/start.5c58580c.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/index.8c1dbec0.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/singletons.195a5806.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/paths.ee001647.js">
		<link rel="modulepreload" href="../_app/immutable/entry/app.8dd63c07.js">
		<link rel="modulepreload" href="../_app/immutable/nodes/0.9334d053.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/mf2.47734ed4.js">
		<link rel="modulepreload" href="../_app/immutable/nodes/4.657d6c5d.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/MarkdownSite.88130736.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/fa.9f83fec8.js"><title>How to set up an SSH Server on Windows with WSL - Tim Bachmann</title><!-- HEAD_svelte-1ula76m_START --><meta property="og:title" content="How to set up an SSH Server on Windows with WSL"><meta property="og:type" content="article"><meta property="og:description" content="It can be very helpful to be able to connect to your laptop or desktop PC from anywhere using SSH. I will show you how to easily set this up on Windows with WSL."><meta property="article:published_time" content="Wed Mar 02 2022 00:00:00 GMT+0000 (Coordinated Universal Time)"><meta property="article:modified_time" content="Wed Mar 02 2022 00:00:00 GMT+0000 (Coordinated Universal Time)"><meta property="article:author" content="Tim Bachmann"><meta property="article:tag" content="dev"><meta property="article:tag" content="ssh"><meta property="article:tag" content="windows"><meta property="article:tag" content="wsl"><meta property="og:image" content="/assets/2022-03-ssh-windows-wsl.png"><!-- HEAD_svelte-1ula76m_END -->
  </head>
  <body>
    <div id="svelte">


<div id="app"><nav class="navbar svelte-1qkwc1i" aria-label="main navigation"><div class="navbar-brand svelte-1qkwc1i"><a class="navbar-item svelte-1qkwc1i" href="/">Tim Bachmann</a></div>
  <div class="navbar-menu desktop svelte-1qkwc1i"><a href="/" class="navbar-item svelte-1qkwc1i">Home</a>
    <a href="/projects" class="navbar-item svelte-1qkwc1i">Projects</a>
    <a href="/blog" class="navbar-item svelte-1qkwc1i">Blog</a>
    <a href="/pages/uses" class="navbar-item svelte-1qkwc1i">Uses</a>
    <a class="navbar-item svelte-1qkwc1i" href="/contact">Contact</a>
    <a class="navbar-item svelte-1qkwc1i" href="/follow">Follow</a></div>
  <div class="navbar-menu mobile svelte-1qkwc1i"><div><input id="header-toggle" class="header-checkbox svelte-1qkwc1i" type="checkbox">
      <label for="header-toggle" class="toggle svelte-1qkwc1i"><span class="svelte-1qkwc1i"></span>
        <span class="svelte-1qkwc1i"></span>
        <span class="svelte-1qkwc1i"></span></label></div>
    </div>
</nav>
  <div class="section">

<div><article class="container h-entry"><figure class="svelte-1vgyhou"><img alt="How to set up an SSH Server on Windows with WSL" src="/assets/2022-03-ssh-windows-wsl.png" class="svelte-1vgyhou">
        </figure>

    <h1><span class="p-name">How to set up an SSH Server on Windows with WSL</span></h1>
    

    <p class="tags"><a class="tag p-category" href="/tags/dev">dev
        </a><a class="tag p-category" href="/tags/ssh">ssh
        </a><a class="tag p-category" href="/tags/windows">windows
        </a><a class="tag p-category" href="/tags/wsl">wsl
        </a></p>

    <div class="by svelte-1vgyhou"><address class="author svelte-1vgyhou">by <a href="/" rel="author">Tim Bachmann</a></address>
      <span>published on <time pubdate datetime="2022-03-02T00:00:00.000Z" class="date dt-published">Wednesday, March 2, 2022</time></span>
</div>

    
    <div class="e-content content svelte-1vgyhou"><!-- HTML_TAG_START --><p>There <a href="https://gist.github.com/dentechy/de2be62b55cfd234681921d5a8b6be11" rel="nofollow noopener noreferrer">are</a> <a href="https://medium.com/@thinkbynumbers/automatically-start-wsl-ssh-and-various-services-on-windows-845dfda89690" rel="nofollow noopener noreferrer">many</a> <a href="https://faun.pub/how-to-setup-ssh-connection-on-ubuntu-windows-subsystem-for-linux-2b36afb943dc" rel="nofollow noopener noreferrer">guides</a> on the <a href="https://superuser.com/questions/1112007/how-to-run-ubuntu-service-on-windows-at-startup" rel="nofollow noopener noreferrer">internet</a> showing how to set up an SSH server <strong>inside</strong> WSL. This is currently not that easy and in my experience, it is not really stable. An alternative to this is to run the SSH server outside of WSL on the windows side and set its default shell to the WSL shell (or any other shell for that matter).</p>
<h2>Installing the OpenSSH Server</h2>
<p>Windows has been shipping with an OpenSSH client and server for a long time. They are not installed by default but can be activated either in the settings as described <a href="https://docs.microsoft.com/en-us/windows-server/administration/openssh/openssh_install_firstuse" rel="nofollow noopener noreferrer">in the official docs</a> or with the following PowerShell commands.</p>
<p><strong>You will need to start PowerShell as Administrator</strong></p>
<p>First, install the OpenSSH client and server.</p>
<pre><code class="language-PowerShell">Add-WindowsCapability -Online -Name OpenSSH.Client~~~~0.0.1.0
Add-WindowsCapability -Online -Name OpenSSH.Server~~~~0.0.1.0
</code></pre>
<p>Enable the SSH service and make sure the firewall rule is configured:</p>
<pre><code class="language-PowerShell"># Enable the service
Start-Service sshd
Set-Service -Name sshd -StartupType 'Automatic'

# Confirm the firewall rule is configured. It should be created automatically by setup. Run the following to verify
if (!(Get-NetFirewallRule -Name "OpenSSH-Server-In-TCP" -ErrorAction SilentlyContinue | Select-Object Name, Enabled)) {
    Write-Output "Firewall Rule 'OpenSSH-Server-In-TCP' does not exist, creating it..."
    New-NetFirewallRule -Name 'OpenSSH-Server-In-TCP' -DisplayName 'OpenSSH Server (sshd)' -Enabled True -Direction Inbound -Protocol TCP -Action Allow -LocalPort 22
} else {
    Write-Output "Firewall rule 'OpenSSH-Server-In-TCP' has been created and exists."
}
</code></pre>
<p>Congratulations, you have installed the SSH server on your Windows machine. And all without manually setting up a background service or modifying config files.</p>
<h2>Setting WSL as Default Shell</h2>
<p>To directly boot into WSL when connecting, we need to change the default shell from <code>cmd.exe</code> or <code>PowerShell.exe</code> to <code>bash.exe</code>, which in turn runs the default WSL distribution. This can be done with the PowerShell command:</p>
<pre><code class="language-PowerShell">New-ItemProperty -Path "HKLM:\SOFTWARE\OpenSSH" -Name DefaultShell -Value "C:\WINDOWS\System32\bash.exe" -PropertyType String -Force
</code></pre>
<p><strong>Note</strong>: even though the shell is running on the Linux side, the SSH server is still on windows. This means you have to use to windows username to log in, and the SCP command copies files relative to the user directory on windows.</p>
<h2>Enable Key-based Authentication (non-Admin User)</h2>
<p><strong>Note</strong>: If the user account has Admin permissions, read the next chapter, otherwise continue reading.</p>
<p>Create the folder <code>.ssh</code> in the users home directory on windows: (e.g. <code>C:\Users\&#x3C;username>\.ssh</code>). Run the following commands in PowerShell (not as administrator).</p>
<pre><code class="language-PowerShell">New-Item -Path ~\.ssh -ItmeType "directory"
New-Item -Path ~\.ssh\authorized_keys
</code></pre>
<p>The file <code>.ssh\autzorized_keys</code> will contain a list of all public keys that shall be allowed to connect to the SSH server.</p>
<p>Copy the contents of your public key file (usually stored in <code>~/.ssh/id_rsa.pub</code>) to the <code>authorized_keys</code> file. If a key is already present, paste your key on a new line.</p>
<h2>Enable Key-based Authentication (Admin User)</h2>
<p>If the user is in the Administrators group, it is not possible to have the <code>authorized_keys</code> file in the user directory for security purposes.
Instead, it needs to be located on the following path <code>%ProgramData%\ssh\administrators_authorized_keys</code>. A second requirement is that it is only accessible to Administrator users, to prevent a normal user from gaining admin permissions.</p>
<p>To create the file start PowerShell as administrator and run the following command.</p>
<pre><code class="language-PowerShell">New-Item -Path $env:programdata\ssh\administrators_authorized_keys
</code></pre>
<p>This will create the file with the correct permissions. Now open the file and paste your public key into it. The public key should be located at <code>~/.ssh/id_rsa.pub</code>. If a key is already present, paste your key on a new line.</p>
<h2>Verifying everything works</h2>
<p>Verify that you can SSH into your machine by running the following inside WSL:</p>
<pre><code class="language-sh">IP=$(cat /etc/resolv.conf | grep nameserver | cut -d " " -f2) # get the windows host ip address
ssh &#x3C;user>@$IP
</code></pre>
<p>Or from PowerShell and cmd:</p>
<pre><code class="language-PowerShell">ssh &#x3C;user>@localhost
</code></pre>
<h2>Drawbacks</h2>
<p>There are some drawbacks to this approach. If you rely on some programs or scripts to work over SSH, this might not be the method for you. Most scripts expect a unix machine on the other end, or if they expect a windows machine they will most likely not be configured to deal with WSL.</p>
<p>If you however just want to connect to your pc to copy some files or change some settings this approach is perfectly fine.</p><!-- HTML_TAG_END --></div>

    

    <div class="outro svelte-1ysgxol" slot="outro"><em>You found an error in this post? Open a
      <a href="https://github.com/Tiim/Tiim.github.io/tree/source/content/blog/2022-03-ssh-windows-wsl.md">pull request</a>.
    </em></div>

    <div class="author-info p-author h-card svelte-gqjfyc"><div class="author-avatar svelte-gqjfyc"><img src="https://media.tiim.ch/tiim.jpg" alt="Photo of Tim Bachmann" class="u-photo svelte-gqjfyc"></div>
  <div><p class="author-bio p-note"><!-- HTML_TAG_START --><p>Hi, my name is <span class="p-name">Tim Bachmann</span>!
I'm a <span class="p-role">master graduate in computer science</span> at <span class="p-org">University of Basel</span>, swimmer and swim coach.</p>
<p>I am passionate about all things web development, swimming, personal knowledge management and much more.
If you liked this or any of my posts, feel free to <a href="https://tiim.ch/follow" rel="nofollow noopener noreferrer">follow me</a>.</p><!-- HTML_TAG_END --></p>
    <div class="author-detail svelte-gqjfyc"><span class="hidden p-gender-identity svelte-gqjfyc">male</span>
      <a href="mailto:hey@tiim.ch" class="p-email">hey@tiim.ch</a>
      <a class="p-url" href="https://tiim.ch/">https://tiim.ch/</a></div></div>
</div>

    <div class="post-details"><p class="hidden p-summary svelte-1vgyhou">It can be very helpful to be able to connect to your laptop or desktop PC from anywhere using SSH. I will show you how to easily set this up on Windows with WSL.</p>
      <a class="hidden p-url p-uid svelte-1vgyhou" href="/blog/2022-03-ssh-windows-wsl">/blog/2022-03-ssh-windows-wsl</a></div></article>
  <div class="container"><h2 class="svelte-z0478z">3 Comments and Interactions</h2>
<span>Leave a comment or interact with this page via
  <a href="http://indieweb.org/webmention">WebMention </a></span>
<div class="comment-form-wrap"><div id="comment-section" class="comment-input svelte-1xby3i5"><span class="avatar svelte-1xby3i5">
<!-- HTML_TAG_START --><!-- HTML_TAG_END --></span>
    <div class="comment-input-content svelte-1xby3i5"><label for="comment-input-name">Name</label>
      <input id="commentName" type="text" placeholder="Name">
      <div class="comment-input-content svelte-1xby3i5"><label for="comment-input-email">E-mail</label>
        <div class="horizontal svelte-1xby3i5"><input id="commentEmail" type="email" placeholder="Email (optional)">
          <div class="checkbox svelte-1xby3i5"><input type="checkbox" id="comment-input-notify" class="svelte-1xby3i5">
            <label for="comment-input-notify">Notify me on replies</label></div></div></div>
      
      <label for="commentContent">Comment</label>
      <textarea id="commentContent" placeholder="Comment" class="svelte-1xby3i5"></textarea>
      <button>Post</button>
      </div></div>
</div>
<ul class="comment-list svelte-z0478z"><li class="comment svelte-z0478z"><span class="avatar svelte-z0478z">
<!-- HTML_TAG_START --><!-- HTML_TAG_END --></span>
      <div class="comment-card svelte-z0478z"><div class="comment-header svelte-z0478z"><h3 id="20f2c526-7466-4c21-83ac-51750f278328" class="svelte-z0478z"></h3>
          <span class="time svelte-z0478z"><a href="https://tiim.ch/blog/2022-03-ssh-windows-wsl#20f2c526-7466-4c21-83ac-51750f278328">2022-09-20 2:59:17 PM
            </a></span>
          <span class="reply-notice svelte-z0478z"></span>
          <span><button class="svelte-z0478z">Reply</button>
            </span></div>
        <span class="reply-notice svelte-z0478z">In reply to
            <a href="#f7c1891b-e97b-4030-863e-19344ed84d32">undefined</a>
          </span>
        <p class="comment-content svelte-z0478z">Hi Tim, no problem. I had this error in "Event Viewer > Applications and Services Logs > OpenSSH > Admin" and figure it out that sshd seems to search the Administrators groups to operate, literal name and not properly localized by region.

erroid:2 user:SYSTEM details:"sshd: error: unable to resolve group administrators"

Maybe is not all the non-english windows with this problem, but I have it but after created the group works like a charm.</p></div>
    </li><li class="comment svelte-z0478z"><span class="avatar svelte-z0478z">
<!-- HTML_TAG_START --><!-- HTML_TAG_END --></span>
      <div class="comment-card svelte-z0478z"><div class="comment-header svelte-z0478z"><h3 id="f7c1891b-e97b-4030-863e-19344ed84d32" class="svelte-z0478z">Tim</h3>
          <span class="time svelte-z0478z"><a href="https://tiim.ch/blog/2022-03-ssh-windows-wsl#f7c1891b-e97b-4030-863e-19344ed84d32">2022-09-20 12:58:29 PM
            </a></span>
          <span class="reply-notice svelte-z0478z"></span>
          <span><button class="svelte-z0478z">Reply</button>
            </span></div>
        <span class="reply-notice svelte-z0478z">In reply to
            <a href="#5de01bc5-b7c7-4522-9dfe-c67f103d4c03">undefined</a>
          </span>
        <p class="comment-content svelte-z0478z">Hi FinderX

Thanks for the heads up. I don't remember having to create a new user group, even though my system language is German. Maybe I just forgot about that though.</p></div>
    </li><li class="comment svelte-z0478z"><span class="avatar svelte-z0478z">
<!-- HTML_TAG_START --><!-- HTML_TAG_END --></span>
      <div class="comment-card svelte-z0478z"><div class="comment-header svelte-z0478z"><h3 id="5de01bc5-b7c7-4522-9dfe-c67f103d4c03" class="svelte-z0478z">FinderX</h3>
          <span class="time svelte-z0478z"><a href="https://tiim.ch/blog/2022-03-ssh-windows-wsl#5de01bc5-b7c7-4522-9dfe-c67f103d4c03">2022-09-20 7:50:46 AM
            </a></span>
          <span class="reply-notice svelte-z0478z"></span>
          <span><button class="svelte-z0478z">Reply</button>
            </span></div>
        
        <p class="comment-content svelte-z0478z">Hi!
I add some roundabouts about admin-users, if your windows ssh server system language is NOT english, you must create 'Administrators' group (without quotes) in your language equivalent of "Users and Local Groups > Groups", if your server is a DC (Domain Controller) create it in your language equivalent of "Active Directories Users and Computers".

Create the user group with name Administrators, description whatever, ex. "Dummy group for sshd to work correctly.", and in Members add your language equivalent of the user Administrator.

This is optional but I suggest you change these settings in "%programdata%\ssh\sshd_config" after you successfully copy your public key to the ssh server :

StrictModes yes
PubkeyAuthentication yes
PasswordAuthentication no

You can see the log activity in your language equivalent of "Applications and Services Logs > OpenSSH > Admin or Operational"

Best Regards.</p></div>
    </li>
</ul></div>
</div></div>
  <div><footer class="svelte-18j7aqw"><div><!-- HTML_TAG_START --><p>Built with SvelteKit and hosted on GitHub Pages.</p>
<p>View this website on <a href="https://github.com/Tiim/Tiim.github.io" rel="nofollow noopener noreferrer">GitHub</a>!</p>
<h2>Other pages</h2>
<ul>
<li><a href="https://tiim.ch/pages/links" rel="nofollow noopener noreferrer">Links and Blogroll</a></li>
</ul><!-- HTML_TAG_END --></div>
  <p class="copyright svelte-18j7aqw">Â©Tim Bachmann 2024</p>
</footer></div></div>


			
			<script>
				{
					__sveltekit_h39q7n = {
						base: new URL("..", location).pathname.slice(0, -1),
						env: {}
					};

					const element = document.currentScript.parentElement;

					const data = [{"type":"data","data":{footer:{html:"\u003Cp>Built with SvelteKit and hosted on GitHub Pages.\u003C/p>\n\u003Cp>View this website on \u003Ca href=\"https://github.com/Tiim/Tiim.github.io\" rel=\"nofollow noopener noreferrer\">GitHub\u003C/a>!\u003C/p>\n\u003Ch2>Other pages\u003C/h2>\n\u003Cul>\n\u003Cli>\u003Ca href=\"https://tiim.ch/pages/links\" rel=\"nofollow noopener noreferrer\">Links and Blogroll\u003C/a>\u003C/li>\n\u003C/ul>",slug:"footer",uuid:"e556fd14-3acd-4a7b-9b31-929fdd6d2b7a",created:new Date(1690834579000),date:new Date(1690834579000),published:true,abstract:"\u003Cp>Built with SvelteKit and hosted on GitHub Pages.\u003C/p>",tags:[],links:void 0,type:"article",cover_image:void 0,description:"",folder:"metadata"}},"uses":{}},{"type":"data","data":{post:{html:"\u003Cp>There \u003Ca href=\"https://gist.github.com/dentechy/de2be62b55cfd234681921d5a8b6be11\" rel=\"nofollow noopener noreferrer\">are\u003C/a> \u003Ca href=\"https://medium.com/@thinkbynumbers/automatically-start-wsl-ssh-and-various-services-on-windows-845dfda89690\" rel=\"nofollow noopener noreferrer\">many\u003C/a> \u003Ca href=\"https://faun.pub/how-to-setup-ssh-connection-on-ubuntu-windows-subsystem-for-linux-2b36afb943dc\" rel=\"nofollow noopener noreferrer\">guides\u003C/a> on the \u003Ca href=\"https://superuser.com/questions/1112007/how-to-run-ubuntu-service-on-windows-at-startup\" rel=\"nofollow noopener noreferrer\">internet\u003C/a> showing how to set up an SSH server \u003Cstrong>inside\u003C/strong> WSL. This is currently not that easy and in my experience, it is not really stable. An alternative to this is to run the SSH server outside of WSL on the windows side and set its default shell to the WSL shell (or any other shell for that matter).\u003C/p>\n\u003Ch2>Installing the OpenSSH Server\u003C/h2>\n\u003Cp>Windows has been shipping with an OpenSSH client and server for a long time. They are not installed by default but can be activated either in the settings as described \u003Ca href=\"https://docs.microsoft.com/en-us/windows-server/administration/openssh/openssh_install_firstuse\" rel=\"nofollow noopener noreferrer\">in the official docs\u003C/a> or with the following PowerShell commands.\u003C/p>\n\u003Cp>\u003Cstrong>You will need to start PowerShell as Administrator\u003C/strong>\u003C/p>\n\u003Cp>First, install the OpenSSH client and server.\u003C/p>\n\u003Cpre>\u003Ccode class=\"language-PowerShell\">Add-WindowsCapability -Online -Name OpenSSH.Client~~~~0.0.1.0\nAdd-WindowsCapability -Online -Name OpenSSH.Server~~~~0.0.1.0\n\u003C/code>\u003C/pre>\n\u003Cp>Enable the SSH service and make sure the firewall rule is configured:\u003C/p>\n\u003Cpre>\u003Ccode class=\"language-PowerShell\"># Enable the service\nStart-Service sshd\nSet-Service -Name sshd -StartupType 'Automatic'\n\n# Confirm the firewall rule is configured. It should be created automatically by setup. Run the following to verify\nif (!(Get-NetFirewallRule -Name \"OpenSSH-Server-In-TCP\" -ErrorAction SilentlyContinue | Select-Object Name, Enabled)) {\n    Write-Output \"Firewall Rule 'OpenSSH-Server-In-TCP' does not exist, creating it...\"\n    New-NetFirewallRule -Name 'OpenSSH-Server-In-TCP' -DisplayName 'OpenSSH Server (sshd)' -Enabled True -Direction Inbound -Protocol TCP -Action Allow -LocalPort 22\n} else {\n    Write-Output \"Firewall rule 'OpenSSH-Server-In-TCP' has been created and exists.\"\n}\n\u003C/code>\u003C/pre>\n\u003Cp>Congratulations, you have installed the SSH server on your Windows machine. And all without manually setting up a background service or modifying config files.\u003C/p>\n\u003Ch2>Setting WSL as Default Shell\u003C/h2>\n\u003Cp>To directly boot into WSL when connecting, we need to change the default shell from \u003Ccode>cmd.exe\u003C/code> or \u003Ccode>PowerShell.exe\u003C/code> to \u003Ccode>bash.exe\u003C/code>, which in turn runs the default WSL distribution. This can be done with the PowerShell command:\u003C/p>\n\u003Cpre>\u003Ccode class=\"language-PowerShell\">New-ItemProperty -Path \"HKLM:\\SOFTWARE\\OpenSSH\" -Name DefaultShell -Value \"C:\\WINDOWS\\System32\\bash.exe\" -PropertyType String -Force\n\u003C/code>\u003C/pre>\n\u003Cp>\u003Cstrong>Note\u003C/strong>: even though the shell is running on the Linux side, the SSH server is still on windows. This means you have to use to windows username to log in, and the SCP command copies files relative to the user directory on windows.\u003C/p>\n\u003Ch2>Enable Key-based Authentication (non-Admin User)\u003C/h2>\n\u003Cp>\u003Cstrong>Note\u003C/strong>: If the user account has Admin permissions, read the next chapter, otherwise continue reading.\u003C/p>\n\u003Cp>Create the folder \u003Ccode>.ssh\u003C/code> in the users home directory on windows: (e.g. \u003Ccode>C:\\Users\\&#x3C;username>\\.ssh\u003C/code>). Run the following commands in PowerShell (not as administrator).\u003C/p>\n\u003Cpre>\u003Ccode class=\"language-PowerShell\">New-Item -Path ~\\.ssh -ItmeType \"directory\"\nNew-Item -Path ~\\.ssh\\authorized_keys\n\u003C/code>\u003C/pre>\n\u003Cp>The file \u003Ccode>.ssh\\autzorized_keys\u003C/code> will contain a list of all public keys that shall be allowed to connect to the SSH server.\u003C/p>\n\u003Cp>Copy the contents of your public key file (usually stored in \u003Ccode>~/.ssh/id_rsa.pub\u003C/code>) to the \u003Ccode>authorized_keys\u003C/code> file. If a key is already present, paste your key on a new line.\u003C/p>\n\u003Ch2>Enable Key-based Authentication (Admin User)\u003C/h2>\n\u003Cp>If the user is in the Administrators group, it is not possible to have the \u003Ccode>authorized_keys\u003C/code> file in the user directory for security purposes.\nInstead, it needs to be located on the following path \u003Ccode>%ProgramData%\\ssh\\administrators_authorized_keys\u003C/code>. A second requirement is that it is only accessible to Administrator users, to prevent a normal user from gaining admin permissions.\u003C/p>\n\u003Cp>To create the file start PowerShell as administrator and run the following command.\u003C/p>\n\u003Cpre>\u003Ccode class=\"language-PowerShell\">New-Item -Path $env:programdata\\ssh\\administrators_authorized_keys\n\u003C/code>\u003C/pre>\n\u003Cp>This will create the file with the correct permissions. Now open the file and paste your public key into it. The public key should be located at \u003Ccode>~/.ssh/id_rsa.pub\u003C/code>. If a key is already present, paste your key on a new line.\u003C/p>\n\u003Ch2>Verifying everything works\u003C/h2>\n\u003Cp>Verify that you can SSH into your machine by running the following inside WSL:\u003C/p>\n\u003Cpre>\u003Ccode class=\"language-sh\">IP=$(cat /etc/resolv.conf | grep nameserver | cut -d \" \" -f2) # get the windows host ip address\nssh &#x3C;user>@$IP\n\u003C/code>\u003C/pre>\n\u003Cp>Or from PowerShell and cmd:\u003C/p>\n\u003Cpre>\u003Ccode class=\"language-PowerShell\">ssh &#x3C;user>@localhost\n\u003C/code>\u003C/pre>\n\u003Ch2>Drawbacks\u003C/h2>\n\u003Cp>There are some drawbacks to this approach. If you rely on some programs or scripts to work over SSH, this might not be the method for you. Most scripts expect a unix machine on the other end, or if they expect a windows machine they will most likely not be configured to deal with WSL.\u003C/p>\n\u003Cp>If you however just want to connect to your pc to copy some files or change some settings this approach is perfectly fine.\u003C/p>",slug:"blog/2022-03-ssh-windows-wsl",uuid:"03b5a86c-5f4d-4086-9f5f-e1e46b4bcf58",title:"How to set up an SSH Server on Windows with WSL",published:true,date:new Date(1646179200000),description:"It can be very helpful to be able to connect to your laptop or desktop PC from anywhere using SSH. I will show you how to easily set this up on Windows with WSL.",cover_image:"/assets/2022-03-ssh-windows-wsl.png",content_tags:["SSH","WSL","Windows","dev"],abstract:"\u003Cp>There \u003Ca href=\"https://gist.github.com/dentechy/de2be62b55cfd234681921d5a8b6be11\">are\u003C/a> \u003Ca href=\"https://medium.com/@thinkbynumbers/automatically-start-wsl-ssh-and-various-services-on-windows-845dfda89690\">many\u003C/a> \u003Ca href=\"https://faun.pub/how-to-setup-ssh-connection-on-ubuntu-windows-subsystem-for-linux-2b36afb943dc\">guides\u003C/a> on the \u003Ca href=\"https://superuser.com/questions/1112007/how-to-run-ubuntu-service-on-windows-at-startup\">internet\u003C/a> showing how to set up an SSH server \u003Cstrong>inside\u003C/strong> WSL. This is currently not that easy and in my experience, it is not really stable. An alternative to this is to run the SSH server outside of WSL on the windows side and set its default shell to the WSL shell (or any other shell for that matter).\u003C/p>",tags:["dev","ssh","windows","wsl"],links:void 0,type:"article",folder:"blog",comments:[{id:"20f2c526-7466-4c21-83ac-51750f278328",type:"comment",replyTo:"f7c1891b-e97b-4030-863e-19344ed84d32",timestamp:"2022-09-20T14:59:17Z",page:"blog/2022-03-ssh-windows-wsl",url:"https://tiim.ch/blog/2022-03-ssh-windows-wsl#20f2c526-7466-4c21-83ac-51750f278328",content:"Hi Tim, no problem. I had this error in \"Event Viewer > Applications and Services Logs > OpenSSH > Admin\" and figure it out that sshd seems to search the Administrators groups to operate, literal name and not properly localized by region.\n\nerroid:2 user:SYSTEM details:\"sshd: error: unable to resolve group administrators\"\n\nMaybe is not all the non-english windows with this problem, but I have it but after created the group works like a charm.",name:""},{id:"f7c1891b-e97b-4030-863e-19344ed84d32",type:"comment",replyTo:"5de01bc5-b7c7-4522-9dfe-c67f103d4c03",timestamp:"2022-09-20T12:58:29Z",page:"blog/2022-03-ssh-windows-wsl",url:"https://tiim.ch/blog/2022-03-ssh-windows-wsl#f7c1891b-e97b-4030-863e-19344ed84d32",content:"Hi FinderX\n\nThanks for the heads up. I don't remember having to create a new user group, even though my system language is German. Maybe I just forgot about that though.",name:"Tim"},{id:"5de01bc5-b7c7-4522-9dfe-c67f103d4c03",type:"comment",replyTo:"",timestamp:"2022-09-20T07:50:46Z",page:"blog/2022-03-ssh-windows-wsl",url:"https://tiim.ch/blog/2022-03-ssh-windows-wsl#5de01bc5-b7c7-4522-9dfe-c67f103d4c03",content:"Hi!\nI add some roundabouts about admin-users, if your windows ssh server system language is NOT english, you must create 'Administrators' group (without quotes) in your language equivalent of \"Users and Local Groups > Groups\", if your server is a DC (Domain Controller) create it in your language equivalent of \"Active Directories Users and Computers\".\n\nCreate the user group with name Administrators, description whatever, ex. \"Dummy group for sshd to work correctly.\", and in Members add your language equivalent of the user Administrator.\n\nThis is optional but I suggest you change these settings in \"%programdata%\\ssh\\sshd_config\" after you successfully copy your public key to the ssh server :\n\nStrictModes yes\nPubkeyAuthentication yes\nPasswordAuthentication no\n\nYou can see the log activity in your language equivalent of \"Applications and Services Logs > OpenSSH > Admin or Operational\"\n\nBest Regards.",name:"FinderX"}],latestComment:"2024-01-20T09:36:14Z"},about:{html:"\u003Cp>Hi, my name is \u003Cspan class=\"p-name\">Tim Bachmann\u003C/span>!\nI'm a \u003Cspan class=\"p-role\">master graduate in computer science\u003C/span> at \u003Cspan class=\"p-org\">University of Basel\u003C/span>, swimmer and swim coach.\u003C/p>\n\u003Cp>I am passionate about all things web development, swimming, personal knowledge management and much more.\nIf you liked this or any of my posts, feel free to \u003Ca href=\"https://tiim.ch/follow\" rel=\"nofollow noopener noreferrer\">follow me\u003C/a>.\u003C/p>",slug:"about",uuid:"d8e56802-2847-4053-b213-9b004f1b965c",date:new Date(1665792000000),created:new Date(1665863229652),published:true,abstract:"\u003Cp>Hi, my name is {{name}}!\nI'm a {{role}} at {{org}}, swimmer and swim coach.\u003C/p>",tags:[],links:void 0,type:"article",cover_image:void 0,description:"",folder:"metadata"}},"uses":{"params":["slug"]}}];

					Promise.all([
						import("../_app/immutable/entry/start.5c58580c.js"),
						import("../_app/immutable/entry/app.8dd63c07.js")
					]).then(([kit, app]) => {
						kit.start(app, element, {
							node_ids: [0, 4],
							data,
							form: null,
							error: null
						});
					});
				}
			</script>
		</div>
  </body>
</html>
