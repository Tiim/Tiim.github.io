<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="/swim-emoji.png" />
    <link rel="manifest" href="/manifest.json" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="alternate"
      type="application/rss+xml"
      title="tiim.ch » Tim Bachmann"
      href="/blog/rss.xml"
    />
    <link href="https://comments.tiim.ch/wm/webmentions" rel="webmention" />
    <link
      href="https://comments.tiim.ch/indieauth/metadata"
      rel="indieauth-metadata"
    />
    <link
      href="https://comments.tiim.ch/indieauth/authorize"
      rel="authorization_endpoint"
    />
    <link
      href="https://comments.tiim.ch/indieauth/token"
      rel="token_endpoint"
    />
    <link rel="micropub" href="https://comments.tiim.ch/micropub" />
    <link rel="microsub" href="https://aperture.p3k.io/microsub/801" />
    <title>Tim Bachmann</title>
    
		<link href="../_app/immutable/assets/0.C6Eg9DJ-.css" rel="stylesheet">
		<link href="../_app/immutable/assets/MarkdownSite.D9jvKssS.css" rel="stylesheet">
		<link href="../_app/immutable/assets/4.Dn2lDdn2.css" rel="stylesheet">
		<link rel="modulepreload" href="../_app/immutable/entry/start.DzMsK6iU.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/BAJ0H9dG.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/N6vMP6K8.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/CeH7VA1m.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/BEFE7IlI.js">
		<link rel="modulepreload" href="../_app/immutable/entry/app.Bj6fPYMv.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/Bzak7iHL.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/tirM1Ya0.js">
		<link rel="modulepreload" href="../_app/immutable/nodes/0.0VHl-ngm.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/AumyIhAL.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/BNYvmXM-.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/dVNlkfcI.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/56KfW9JE.js">
		<link rel="modulepreload" href="../_app/immutable/nodes/4.CnFQrugk.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/BwmfcpTx.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/Cf1uxiy_.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/C-mP__dA.js"><!--18fneu1--><meta property="og:title" content="My Selfhosting Setup"/> <meta property="og:type" content="article"/> <meta property="og:description" content="A short overview on how I self-host."/> <!--[--><meta property="article:published_time" content="Mon Dec 04 2023 08:00:00 GMT+0000 (Coordinated Universal Time)"/><!--]--> <!--[--><meta property="article:modified_time" content="Mon Dec 04 2023 08:00:00 GMT+0000 (Coordinated Universal Time)"/><!--]--> <meta property="article:author" content="Tim Bachmann"/> <!--[--><meta property="article:tag" content="ansible"/><meta property="article:tag" content="docker"/><meta property="article:tag" content="server"/><meta property="article:tag" content="traefik"/><!--]--> <!--[--><meta property="og:image" content="https://media.tiim.ch/4a0a43eb-cf95-4273-b6a6-e085c9123985.webp"/><!--]--><!----><title>My Selfhosting Setup - Tim Bachmann</title>
  </head>
  <body>
    <div id="svelte"><!--[--><!--[--><!----><div id="app"><nav class="navbar svelte-se4uza" aria-label="main navigation"><div class="navbar-brand svelte-se4uza"><a class="navbar-item svelte-se4uza" href="/">Tim Bachmann</a></div> <div class="navbar-menu desktop svelte-se4uza"><a href="/" class="navbar-item svelte-se4uza">Home</a> <a href="/projects" class="navbar-item svelte-se4uza">Projects</a> <a href="/blog" class="navbar-item svelte-se4uza">Blog</a> <a href="/pages/uses" class="navbar-item svelte-se4uza">Uses</a> <a class="navbar-item svelte-se4uza" href="/contact">Contact</a> <a class="navbar-item svelte-se4uza" href="/follow">Follow</a></div> <div class="navbar-menu mobile svelte-se4uza"><div><input id="header-toggle" class="header-checkbox svelte-se4uza" type="checkbox"/> <label for="header-toggle" class="toggle svelte-se4uza"><span class="svelte-se4uza"></span> <span class="svelte-se4uza"></span> <span class="svelte-se4uza"></span></label></div> <!--[!--><!--]--></div></nav><!----> <div class="section"><!--[--><!----><div><article class="container h-entry"><!--[--><figure class="svelte-18fneu1"><img class="u-featured svelte-18fneu1" alt="My Selfhosting Setup" src="https://media.tiim.ch/4a0a43eb-cf95-4273-b6a6-e085c9123985.webp"/> <!--[--><figcaption class="svelte-18fneu1">Model: realvisxlV20_v20Bakedvae; beach sunset, palms, calm ocean, fine sand, cinematic shot, photorealistic ## (worst quality)</figcaption><!--]--></figure><!--]--> <h1><span class="p-name">My Selfhosting Setup</span></h1> <!--[!--><!--]--> <p class="tags"><!--[--><a class="tag p-category" href="/tags/ansible">ansible</a><a class="tag p-category" href="/tags/docker">docker</a><a class="tag p-category" href="/tags/server">server</a><a class="tag p-category" href="/tags/traefik">traefik</a><!--]--></p> <div class="by svelte-18fneu1"><address class="author svelte-18fneu1">by <a class="u-author" href="/" rel="author">Tim Bachmann</a></address> <!--[--><span>published on <time pubdate="" datetime="2023-12-04T08:00:00.000Z" class="date dt-published">Monday, December 4, 2023</time></span><!--]--> <!--[!--><!--]--><!----></div> <!--[!--><!--]--> <div class="e-content content svelte-18fneu1"><!----><blockquote class="callout callout-note">
<span class="callout-title"><span class="callout-icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M64 32C28.7 32 0 60.7 0 96v320c0 35.3 28.7 64 64 64h226.7c17 0 33.3-6.7 45.3-18.7l93.3-93.3c12-12 18.7-28.3 18.7-45.3V96c0-35.3-28.7-64-64-64zm0 64h320v224h-64c-17.7 0-32 14.3-32 32v64H64z"></path></svg></span>Note</span><p>This post is meant as a reference for myself. I only published it in case someone else might find it interesting.
I did not spend much time on this post.</p>
</blockquote>
<p>I do host some services on a few rented VPS servers and on my "home lab", which is just an old desktop that is running in the basement.
When I got into self-hosting, I decided I would host everything exclusively in docker, which has served me pretty well over the last few years. In the last while I
have learned a lot about Kubernetes, and am strongly considering switching my "simple" hosting setup for a more complex Kubernetes cluster. So before I do that I want
to write down what my current setup looks like.</p>
<h2>Setup</h2>
<p><img src="https://media.tiim.ch/0887e318-9359-4753-abaf-49ae7c26dfcd.webp" alt=""></p>
<p>As mentioned, everything is hosted in docker containers. Generally, I try to keep everything in docker-compose, since this allows me to specify the settings of the container once, and easily modify it later.
To have multiple services available on port 80 and 443, I use the Traeffik (Software) reverse proxy. I use Traefik without a config file, meaning it pulls the routes and rules directly from the labels of the
running containers on the VPS. This makes it easy to launch a new service and have its reverse proxy config directly in the docker-compose file.</p>
<p>Since many services use a database, and Postgres seems to be supported by many open-source projects, I decided to have a central Postgres instance running in a docker container. This allows me to
back it up with a simple cron job in a single place. If a service does not support Postgres, I specify its database directly in the docker-compose file.</p>
<p>Almost all services use disk access for either config, local files, or similar. I do have a docker folder that is the root of all locally stored files.</p>
<h2>OS Setup</h2>
<p>When I first started, I configured everything by hand, and documented how, why, and what I did. However I was not happy with this, I could not test it out and it was prone to errors.
Therefore, I decided to use Ansible to set up the server and install all dependencies.
This worked well, so well that I decided that Ansible was good enough to use to operate the entire pipeline, even to automate the deployment of the services.</p>
<h2>Deployment</h2>
<p>I do have an ansible role per service, with its configuration (mostly) as ansible YAML files, and the docker-compose files and other config files as ansible templates. This worked great, with a single ansible-playbook command I can
make sure everything is running and has the right config.
For most services, I even built logic to make sure that when the docker-compose file or a config file changes, the container is restarted.</p>
<h2>The good parts</h2>
<p>I am quite happy with this system in general. Everything runs stable, backups are easy and automated, and deployments for services that are already configured are a breeze.
I can keep the whole "description" of what is running in a single git repo, and make changes by editing config files.
This is a huge step up from manually deploying and keeping track of what docker commands to use for what service.</p>
<h2>The not so good parts</h2>
<p>Recently I noticed some pain points.</p>
<ol>
<li>If I want to deploy a service twice for two domain names, I have to create a copy of the role. This unfortunately leads to duplicated "code" which can (and does) lead to configuration drift.</li>
<li>I have to code things myself that already exist. For example, restarting a container when a config value changes. For most services this is implemented, but not everywhere, and also not for all possible things that can be changed. This is not what I want to be concentrating on if I am writing the config to deploy a service.</li>
</ol>
<p>In general, I seem to have built a worse subset of Kubernetes myself, just without the robustness that makes Kubernetes so interesting.</p>
<h2>My plan for the future</h2>
<p>I am planning to replace docker with Kubernetes, specifically K3s (Software), a very lightweight and mostly "batteries included" Kubernetes distribution.
Ansible will stay, but only as a tool to set up and configure the OS, install dependencies, and install and run K3S. Deployment of services I either want to do directly using the kubectl command line tool, or more likely using
ArgoCD, a project that pulls Kubernetes manifests from a Git repository and automatically deploys it.</p>
<p>For the configuration, I will take a look at Helm (Software).</p><!----></div> <!--[!--><!--]--> <!--[--><div class="outro svelte-1teoznn" slot="outro"><em>You found an error in this post? Open a <a href="https://github.com/Tiim/Tiim.github.io/tree/source/content/blog/2023-12-03-my-selfhosting-setup.md">pull request</a>.</em></div><!--]--> <div class="author-info p-author h-card svelte-2gqjly"><div class="author-avatar svelte-2gqjly"><img src="https://avatars.githubusercontent.com/u/1063187" alt="Photo of Tim Bachmann" class="u-photo svelte-2gqjly"/></div> <div><p class="author-bio p-note"><!----><p>Hi, my name is <span class="p-name">Tim Bachmann</span>!
I'm a <span class="p-role">software engineer</span> at <span class="p-org">Coop Genossenschaft</span>, swimmer and swim coach.</p>
<p>I am passionate about all things web development, swimming, personal knowledge management and much more.
If you liked this or any of my posts, feel free to <a href="https://tiim.ch/follow" rel="nofollow noopener noreferrer">follow me</a>.</p><!----></p> <div class="author-detail svelte-2gqjly"><span class="hidden p-name svelte-2gqjly">Tim Bachmann</span> <span class="hidden p-gender-identity svelte-2gqjly">male</span> <span class="hidden p-locality svelte-2gqjly">Basel</span> <span class="hidden p-country-name svelte-2gqjly">Switzerland</span> <span class="hidden p-org svelte-2gqjly">Coop Genossenschaft</span> <span class="hidden p-role svelte-2gqjly">software engineer</span> <a href="mailto:hey@tiim.ch" class="p-email">hey@tiim.ch</a> <a class="p-url" href="https://tiim.ch/">https://tiim.ch/</a></div></div></div><!----> <div class="post-details"><!--[--><p class="hidden p-summary svelte-18fneu1">A short overview on how I self-host.</p><!--]--> <a class="hidden p-url p-uid svelte-18fneu1" href="/blog/2023-12-03-my-selfhosting-setup">/blog/2023-12-03-my-selfhosting-setup</a></div></article></div><!----><!--]--></div> <div><footer class="svelte-cfdhmy"><div><!----><p>Built with SvelteKit and hosted on GitHub Pages.</p>
<p>View this website on <a href="https://github.com/Tiim/Tiim.github.io" rel="nofollow noopener noreferrer">GitHub</a>!</p>
<h2>Other pages</h2>
<ul>
<li><a href="https://tiim.ch/pages/links" rel="nofollow noopener noreferrer">Links and Blogroll</a></li>
</ul><!----></div> <p class="copyright svelte-cfdhmy">©Tim Bachmann 2026</p></footer><!----></div></div><!----><!--]--> <!--[!--><!--]--><!--]-->
			
			<script>
				{
					__sveltekit_1a0qsqe = {
						base: new URL("..", location).pathname.slice(0, -1)
					};

					const element = document.currentScript.parentElement;

					Promise.all([
						import("../_app/immutable/entry/start.DzMsK6iU.js"),
						import("../_app/immutable/entry/app.Bj6fPYMv.js")
					]).then(([kit, app]) => {
						kit.start(app, element, {
							node_ids: [0, 4],
							data: [{type:"data",data:{footer:{html:"\u003Cp>Built with SvelteKit and hosted on GitHub Pages.\u003C/p>\n\u003Cp>View this website on \u003Ca href=\"https://github.com/Tiim/Tiim.github.io\" rel=\"nofollow noopener noreferrer\">GitHub\u003C/a>!\u003C/p>\n\u003Ch2>Other pages\u003C/h2>\n\u003Cul>\n\u003Cli>\u003Ca href=\"https://tiim.ch/pages/links\" rel=\"nofollow noopener noreferrer\">Links and Blogroll\u003C/a>\u003C/li>\n\u003C/ul>",slug:"footer",uuid:"e556fd14-3acd-4a7b-9b31-929fdd6d2b7a",created:new Date(1690834579000),date:new Date(1690834579000),published:true,abstract:"\u003Cp>Built with SvelteKit and hosted on GitHub Pages.\u003C/p>",tags:[],links:void 0,type:"article",cover_image:void 0,description:"",folder:"metadata"}},uses:{}},{type:"data",data:{post:{html:"\u003Cblockquote class=\"callout callout-note\">\n\u003Cspan class=\"callout-title\">\u003Cspan class=\"callout-icon\">\u003Csvg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 448 512\">\u003Cpath d=\"M64 32C28.7 32 0 60.7 0 96v320c0 35.3 28.7 64 64 64h226.7c17 0 33.3-6.7 45.3-18.7l93.3-93.3c12-12 18.7-28.3 18.7-45.3V96c0-35.3-28.7-64-64-64zm0 64h320v224h-64c-17.7 0-32 14.3-32 32v64H64z\">\u003C/path>\u003C/svg>\u003C/span>Note\u003C/span>\u003Cp>This post is meant as a reference for myself. I only published it in case someone else might find it interesting.\nI did not spend much time on this post.\u003C/p>\n\u003C/blockquote>\n\u003Cp>I do host some services on a few rented VPS servers and on my \"home lab\", which is just an old desktop that is running in the basement.\nWhen I got into self-hosting, I decided I would host everything exclusively in docker, which has served me pretty well over the last few years. In the last while I\nhave learned a lot about Kubernetes, and am strongly considering switching my \"simple\" hosting setup for a more complex Kubernetes cluster. So before I do that I want\nto write down what my current setup looks like.\u003C/p>\n\u003Ch2>Setup\u003C/h2>\n\u003Cp>\u003Cimg src=\"https://media.tiim.ch/0887e318-9359-4753-abaf-49ae7c26dfcd.webp\" alt=\"\">\u003C/p>\n\u003Cp>As mentioned, everything is hosted in docker containers. Generally, I try to keep everything in docker-compose, since this allows me to specify the settings of the container once, and easily modify it later.\nTo have multiple services available on port 80 and 443, I use the Traeffik (Software) reverse proxy. I use Traefik without a config file, meaning it pulls the routes and rules directly from the labels of the\nrunning containers on the VPS. This makes it easy to launch a new service and have its reverse proxy config directly in the docker-compose file.\u003C/p>\n\u003Cp>Since many services use a database, and Postgres seems to be supported by many open-source projects, I decided to have a central Postgres instance running in a docker container. This allows me to\nback it up with a simple cron job in a single place. If a service does not support Postgres, I specify its database directly in the docker-compose file.\u003C/p>\n\u003Cp>Almost all services use disk access for either config, local files, or similar. I do have a docker folder that is the root of all locally stored files.\u003C/p>\n\u003Ch2>OS Setup\u003C/h2>\n\u003Cp>When I first started, I configured everything by hand, and documented how, why, and what I did. However I was not happy with this, I could not test it out and it was prone to errors.\nTherefore, I decided to use Ansible to set up the server and install all dependencies.\nThis worked well, so well that I decided that Ansible was good enough to use to operate the entire pipeline, even to automate the deployment of the services.\u003C/p>\n\u003Ch2>Deployment\u003C/h2>\n\u003Cp>I do have an ansible role per service, with its configuration (mostly) as ansible YAML files, and the docker-compose files and other config files as ansible templates. This worked great, with a single ansible-playbook command I can\nmake sure everything is running and has the right config.\nFor most services, I even built logic to make sure that when the docker-compose file or a config file changes, the container is restarted.\u003C/p>\n\u003Ch2>The good parts\u003C/h2>\n\u003Cp>I am quite happy with this system in general. Everything runs stable, backups are easy and automated, and deployments for services that are already configured are a breeze.\nI can keep the whole \"description\" of what is running in a single git repo, and make changes by editing config files.\nThis is a huge step up from manually deploying and keeping track of what docker commands to use for what service.\u003C/p>\n\u003Ch2>The not so good parts\u003C/h2>\n\u003Cp>Recently I noticed some pain points.\u003C/p>\n\u003Col>\n\u003Cli>If I want to deploy a service twice for two domain names, I have to create a copy of the role. This unfortunately leads to duplicated \"code\" which can (and does) lead to configuration drift.\u003C/li>\n\u003Cli>I have to code things myself that already exist. For example, restarting a container when a config value changes. For most services this is implemented, but not everywhere, and also not for all possible things that can be changed. This is not what I want to be concentrating on if I am writing the config to deploy a service.\u003C/li>\n\u003C/ol>\n\u003Cp>In general, I seem to have built a worse subset of Kubernetes myself, just without the robustness that makes Kubernetes so interesting.\u003C/p>\n\u003Ch2>My plan for the future\u003C/h2>\n\u003Cp>I am planning to replace docker with Kubernetes, specifically K3s (Software), a very lightweight and mostly \"batteries included\" Kubernetes distribution.\nAnsible will stay, but only as a tool to set up and configure the OS, install dependencies, and install and run K3S. Deployment of services I either want to do directly using the kubectl command line tool, or more likely using\nArgoCD, a project that pulls Kubernetes manifests from a Git repository and automatically deploys it.\u003C/p>\n\u003Cp>For the configuration, I will take a look at Helm (Software).\u003C/p>",slug:"blog/2023-12-03-my-selfhosting-setup",uuid:"3af67a63-5f3a-422c-8aee-5e3daa8921f9",date:new Date(1701676800000),created:new Date(1701637696000),aliases:null,title:"My Selfhosting Setup",published:true,modified:null,description:"A short overview on how I self-host.",cover_image:"https://media.tiim.ch/4a0a43eb-cf95-4273-b6a6-e085c9123985.webp",cover_image_txt:"Model: realvisxlV20_v20Bakedvae; beach sunset, palms, calm ocean, fine sand, cinematic shot, photorealistic ## (worst quality)",content_tags:["ansible","docker","traefik","server"],abstract:"\u003Cp>[!NOTE]\nThis post is meant as a reference for myself. I only published it in case someone else might find it interesting.\nI did not spend much time on this post.\u003C/p>",tags:["ansible","docker","server","traefik"],links:void 0,type:"article",folder:"blog"},about:{html:"\u003Cp>Hi, my name is \u003Cspan class=\"p-name\">Tim Bachmann\u003C/span>!\nI'm a \u003Cspan class=\"p-role\">software engineer\u003C/span> at \u003Cspan class=\"p-org\">Coop Genossenschaft\u003C/span>, swimmer and swim coach.\u003C/p>\n\u003Cp>I am passionate about all things web development, swimming, personal knowledge management and much more.\nIf you liked this or any of my posts, feel free to \u003Ca href=\"https://tiim.ch/follow\" rel=\"nofollow noopener noreferrer\">follow me\u003C/a>.\u003C/p>",slug:"about",uuid:"d8e56802-2847-4053-b213-9b004f1b965c",date:new Date(1665792000000),created:new Date(1665863229652),published:true,abstract:"\u003Cp>Hi, my name is {{name}}!\nI'm a {{role}} at {{org}}, swimmer and swim coach.\u003C/p>",tags:[],links:void 0,type:"article",cover_image:void 0,description:"",folder:"metadata"}},uses:{params:["slug"]}}],
							form: null,
							error: null
						});
					});
				}
			</script>
		</div>
  </body>
</html>
