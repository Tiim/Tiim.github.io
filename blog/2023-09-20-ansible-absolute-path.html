<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="/swim-emoji.png" />
    <link rel="manifest" href="/manifest.json" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="alternate"
      type="application/rss+xml"
      title="tiim.ch Â» Tim Bachmann"
      href="/blog/rss.xml"
    />
    <link href="https://comments.tiim.ch/wm/webmentions" rel="webmention" />
    <link
      href="https://comments.tiim.ch/indieauth/metadata"
      rel="indieauth-metadata"
    />
    <link
      href="https://comments.tiim.ch/indieauth/authorize"
      rel="authorization_endpoint"
    />
    <link
      href="https://comments.tiim.ch/indieauth/token"
      rel="token_endpoint"
    />
    <link rel="micropub" href="https://comments.tiim.ch/micropub" />
    <link rel="microsub" href="https://aperture.p3k.io/microsub/801" />
    <title>Tim Bachmann</title>
    
		<link href="../_app/immutable/assets/0.8d503a92.css" rel="stylesheet">
		<link href="../_app/immutable/assets/4.32b0d823.css" rel="stylesheet">
		<link href="../_app/immutable/assets/MarkdownSite.52351ed7.css" rel="stylesheet">
		<link rel="modulepreload" href="../_app/immutable/entry/start.5c58580c.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/index.8c1dbec0.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/singletons.195a5806.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/paths.ee001647.js">
		<link rel="modulepreload" href="../_app/immutable/entry/app.8dd63c07.js">
		<link rel="modulepreload" href="../_app/immutable/nodes/0.9334d053.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/mf2.47734ed4.js">
		<link rel="modulepreload" href="../_app/immutable/nodes/4.657d6c5d.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/MarkdownSite.88130736.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/fa.9f83fec8.js"><title>Getting the Absolute Path of a Remote Directory in Ansible - Tim Bachmann</title><!-- HEAD_svelte-1ula76m_START --><meta property="og:title" content="Getting the Absolute Path of a Remote Directory in Ansible"><meta property="og:type" content="article"><meta property="og:description" content="There is no builtin way to convert a relative path to an absolute path in ansible. However we can use the readlink command for this."><meta property="article:published_time" content="Wed Sep 20 2023 21:39:13 GMT+0000 (Coordinated Universal Time)"><meta property="article:modified_time" content="Wed Sep 20 2023 21:39:13 GMT+0000 (Coordinated Universal Time)"><meta property="article:author" content="Tim Bachmann"><meta property="article:tag" content="ansible"><meta property="article:tag" content="bash"><meta property="article:tag" content="dev"><meta property="article:tag" content="linux"><meta property="og:image" content="https://media.tiim.ch/3c1246e4-3201-4df6-af87-6aa4ab98800e.webp"><!-- HEAD_svelte-1ula76m_END -->
  </head>
  <body>
    <div id="svelte">


<div id="app"><nav class="navbar svelte-1qkwc1i" aria-label="main navigation"><div class="navbar-brand svelte-1qkwc1i"><a class="navbar-item svelte-1qkwc1i" href="/">Tim Bachmann</a></div>
  <div class="navbar-menu desktop svelte-1qkwc1i"><a href="/" class="navbar-item svelte-1qkwc1i">Home</a>
    <a href="/projects" class="navbar-item svelte-1qkwc1i">Projects</a>
    <a href="/blog" class="navbar-item svelte-1qkwc1i">Blog</a>
    <a href="/pages/uses" class="navbar-item svelte-1qkwc1i">Uses</a>
    <a class="navbar-item svelte-1qkwc1i" href="/contact">Contact</a>
    <a class="navbar-item svelte-1qkwc1i" href="/follow">Follow</a></div>
  <div class="navbar-menu mobile svelte-1qkwc1i"><div><input id="header-toggle" class="header-checkbox svelte-1qkwc1i" type="checkbox">
      <label for="header-toggle" class="toggle svelte-1qkwc1i"><span class="svelte-1qkwc1i"></span>
        <span class="svelte-1qkwc1i"></span>
        <span class="svelte-1qkwc1i"></span></label></div>
    </div>
</nav>
  <div class="section">

<div><article class="container h-entry"><figure class="svelte-1vgyhou"><img alt="Getting the Absolute Path of a Remote Directory in Ansible" src="https://media.tiim.ch/3c1246e4-3201-4df6-af87-6aa4ab98800e.webp" class="svelte-1vgyhou">
        <figcaption class="svelte-1vgyhou">(stable doodle) server room, neon, cables</figcaption></figure>

    <h1><span class="p-name">Getting the Absolute Path of a Remote Directory in Ansible</span></h1>
    

    <p class="tags"><a class="tag p-category" href="/tags/ansible">ansible
        </a><a class="tag p-category" href="/tags/bash">bash
        </a><a class="tag p-category" href="/tags/dev">dev
        </a><a class="tag p-category" href="/tags/linux">linux
        </a></p>

    <div class="by svelte-1vgyhou"><address class="author svelte-1vgyhou">by <a href="/" rel="author">Tim Bachmann</a></address>
      <span>published on <time pubdate datetime="2023-09-20T21:39:13.000Z" class="date dt-published">Wednesday, September 20, 2023</time></span>
</div>

    
    <div class="e-content content svelte-1vgyhou"><!-- HTML_TAG_START --><p>I recently had to find a way to delete a folder using Ansible that was being created by Docker. The folder had a path like <code>~/docker/myservice</code>. Since docker had created it as part of a volume, the folder did not belong to the current user. So deleting the folder using normal permissions failed.</p>
<p>Deleting with elevated permission on the command line is easy: The command <code>sudo rm -rf ~/docker/myservice</code> performs the <code>rm</code> operation as the root user. In bash, this will delete the <code>docker/myservice</code> folder in the user's home directory, but when doing the equivalent in Ansible, this won't work!</p>
<pre><code class="language-yaml"># This does not work!
- name: Delete the folder using root permissions
  become: true
  ansible.builtin.file:
    path: "~/docker/myservice"
    state: "absent"
</code></pre>
<p>This code will try to delete the file <code>/user/root/docker/myservice</code>, which is not what we wanted.</p>
<p>The bash version works because the shell first resolves the tilde in the argument to the current users' directory before calling the sudo command. In Ansible, we first switch to the root user and only then the tilde is resolved: this time to the home directory of the root user.</p>
<p>To circumvent this, we can manually resolve the path to an absolute path. Unfortunately, I have not found a straightforward way to do this in Ansible, however the bash command <code>readlink -f &#x3C;path></code> does exactly this. To use it in Ansible, we can use the following configuration:</p>
<pre><code class="language-yaml">- name: Get absolute folder path
  ansible.builtin.command:
    cmd: "readlink -f ~/docker/myservice"
  register: folder_abs
  changed_when: False

- name: Debug
  debug:
    msg: "{{folder_abs.stdout}}" # prints /user/tim/docker/myservice

- name: Delete the folder using root permissions
  become: true
  ansible.builtin.file:
    path: "{{folder_abs.stdout}}"
    state: "absent"
</code></pre>
<p>With this Ansible script, we manually resolve the absolute path and use it to delete the folder using root permissions. If you know of an easier way to resolve to an absolute path, please let me know!</p><!-- HTML_TAG_END --></div>

    

    <div class="outro svelte-1ysgxol" slot="outro"><em>You found an error in this post? Open a
      <a href="https://github.com/Tiim/Tiim.github.io/tree/source/content/blog/2023-09-20-ansible-absolute-path.md">pull request</a>.
    </em></div>

    <div class="author-info p-author h-card svelte-gqjfyc"><div class="author-avatar svelte-gqjfyc"><img src="https://media.tiim.ch/tiim.jpg" alt="Photo of Tim Bachmann" class="u-photo svelte-gqjfyc"></div>
  <div><p class="author-bio p-note"><!-- HTML_TAG_START --><p>Hi, my name is <span class="p-name">Tim Bachmann</span>!
I'm a <span class="p-role">master graduate in computer science</span> at <span class="p-org">University of Basel</span>, swimmer and swim coach.</p>
<p>I am passionate about all things web development, swimming, personal knowledge management and much more.
If you liked this or any of my posts, feel free to <a href="https://tiim.ch/follow" rel="nofollow noopener noreferrer">follow me</a>.</p><!-- HTML_TAG_END --></p>
    <div class="author-detail svelte-gqjfyc"><span class="hidden p-gender-identity svelte-gqjfyc">male</span>
      <a href="mailto:hey@tiim.ch" class="p-email">hey@tiim.ch</a>
      <a class="p-url" href="https://tiim.ch/">https://tiim.ch/</a></div></div>
</div>

    <div class="post-details"><p class="hidden p-summary svelte-1vgyhou">There is no builtin way to convert a relative path to an absolute path in ansible. However we can use the readlink command for this.</p>
      <a class="hidden p-url p-uid svelte-1vgyhou" href="/blog/2023-09-20-ansible-absolute-path">/blog/2023-09-20-ansible-absolute-path</a></div></article>
  <div class="container"><h2 class="svelte-z0478z">0 Comments and Interactions</h2>
<span>Leave a comment or interact with this page via
  <a href="http://indieweb.org/webmention">WebMention </a></span>
<div class="comment-form-wrap"><div id="comment-section" class="comment-input svelte-1xby3i5"><span class="avatar svelte-1xby3i5">
<!-- HTML_TAG_START --><!-- HTML_TAG_END --></span>
    <div class="comment-input-content svelte-1xby3i5"><label for="comment-input-name">Name</label>
      <input id="commentName" type="text" placeholder="Name">
      <div class="comment-input-content svelte-1xby3i5"><label for="comment-input-email">E-mail</label>
        <div class="horizontal svelte-1xby3i5"><input id="commentEmail" type="email" placeholder="Email (optional)">
          <div class="checkbox svelte-1xby3i5"><input type="checkbox" id="comment-input-notify" class="svelte-1xby3i5">
            <label for="comment-input-notify">Notify me on replies</label></div></div></div>
      
      <label for="commentContent">Comment</label>
      <textarea id="commentContent" placeholder="Comment" class="svelte-1xby3i5"></textarea>
      <button>Post</button>
      </div></div>
</div>
<ul class="comment-list svelte-z0478z">
</ul></div>
</div></div>
  <div><footer class="svelte-18j7aqw"><div><!-- HTML_TAG_START --><p>Built with SvelteKit and hosted on GitHub Pages.</p>
<p>View this website on <a href="https://github.com/Tiim/Tiim.github.io" rel="nofollow noopener noreferrer">GitHub</a>!</p>
<h2>Other pages</h2>
<ul>
<li><a href="https://tiim.ch/pages/links" rel="nofollow noopener noreferrer">Links and Blogroll</a></li>
</ul><!-- HTML_TAG_END --></div>
  <p class="copyright svelte-18j7aqw">Â©Tim Bachmann 2024</p>
</footer></div></div>


			
			<script>
				{
					__sveltekit_h39q7n = {
						base: new URL("..", location).pathname.slice(0, -1),
						env: {}
					};

					const element = document.currentScript.parentElement;

					const data = [{"type":"data","data":{footer:{html:"\u003Cp>Built with SvelteKit and hosted on GitHub Pages.\u003C/p>\n\u003Cp>View this website on \u003Ca href=\"https://github.com/Tiim/Tiim.github.io\" rel=\"nofollow noopener noreferrer\">GitHub\u003C/a>!\u003C/p>\n\u003Ch2>Other pages\u003C/h2>\n\u003Cul>\n\u003Cli>\u003Ca href=\"https://tiim.ch/pages/links\" rel=\"nofollow noopener noreferrer\">Links and Blogroll\u003C/a>\u003C/li>\n\u003C/ul>",slug:"footer",uuid:"e556fd14-3acd-4a7b-9b31-929fdd6d2b7a",created:new Date(1690834579000),date:new Date(1690834579000),published:true,abstract:"\u003Cp>Built with SvelteKit and hosted on GitHub Pages.\u003C/p>",tags:[],links:void 0,type:"article",cover_image:void 0,description:"",folder:"metadata"}},"uses":{}},{"type":"data","data":{post:{html:"\u003Cp>I recently had to find a way to delete a folder using Ansible that was being created by Docker. The folder had a path like \u003Ccode>~/docker/myservice\u003C/code>. Since docker had created it as part of a volume, the folder did not belong to the current user. So deleting the folder using normal permissions failed.\u003C/p>\n\u003Cp>Deleting with elevated permission on the command line is easy: The command \u003Ccode>sudo rm -rf ~/docker/myservice\u003C/code> performs the \u003Ccode>rm\u003C/code> operation as the root user. In bash, this will delete the \u003Ccode>docker/myservice\u003C/code> folder in the user's home directory, but when doing the equivalent in Ansible, this won't work!\u003C/p>\n\u003Cpre>\u003Ccode class=\"language-yaml\"># This does not work!\n- name: Delete the folder using root permissions\n  become: true\n  ansible.builtin.file:\n    path: \"~/docker/myservice\"\n    state: \"absent\"\n\u003C/code>\u003C/pre>\n\u003Cp>This code will try to delete the file \u003Ccode>/user/root/docker/myservice\u003C/code>, which is not what we wanted.\u003C/p>\n\u003Cp>The bash version works because the shell first resolves the tilde in the argument to the current users' directory before calling the sudo command. In Ansible, we first switch to the root user and only then the tilde is resolved: this time to the home directory of the root user.\u003C/p>\n\u003Cp>To circumvent this, we can manually resolve the path to an absolute path. Unfortunately, I have not found a straightforward way to do this in Ansible, however the bash command \u003Ccode>readlink -f &#x3C;path>\u003C/code> does exactly this. To use it in Ansible, we can use the following configuration:\u003C/p>\n\u003Cpre>\u003Ccode class=\"language-yaml\">- name: Get absolute folder path\n  ansible.builtin.command:\n    cmd: \"readlink -f ~/docker/myservice\"\n  register: folder_abs\n  changed_when: False\n\n- name: Debug\n  debug:\n    msg: \"{{folder_abs.stdout}}\" # prints /user/tim/docker/myservice\n\n- name: Delete the folder using root permissions\n  become: true\n  ansible.builtin.file:\n    path: \"{{folder_abs.stdout}}\"\n    state: \"absent\"\n\u003C/code>\u003C/pre>\n\u003Cp>With this Ansible script, we manually resolve the absolute path and use it to delete the folder using root permissions. If you know of an easier way to resolve to an absolute path, please let me know!\u003C/p>",slug:"blog/2023-09-20-ansible-absolute-path",uuid:"ad58acaf-56b0-4bcf-9b72-d6c054fc48d4",date:new Date(1695245953000),created:new Date(1695241355634),aliases:null,title:"Getting the Absolute Path of a Remote Directory in Ansible",published:true,modified:null,description:"There is no builtin way to convert a relative path to an absolute path in ansible. However we can use the readlink command for this.",cover_image:"https://media.tiim.ch/3c1246e4-3201-4df6-af87-6aa4ab98800e.webp",cover_image_txt:"(stable doodle) server room, neon, cables",content_tags:["dev","ansible","linux","bash"],abstract:"\u003Cp>I recently had to find a way to delete a folder using Ansible that was being created by Docker. The folder had a path like \u003Ccode>~/docker/myservice\u003C/code>. Since docker had created it as part of a volume, the folder did not belong to the current user. So deleting the folder using normal permissions failed.\u003C/p>",tags:["ansible","bash","dev","linux"],links:void 0,type:"article",folder:"blog",comments:[],latestComment:"2024-01-20T09:36:14Z"},about:{html:"\u003Cp>Hi, my name is \u003Cspan class=\"p-name\">Tim Bachmann\u003C/span>!\nI'm a \u003Cspan class=\"p-role\">master graduate in computer science\u003C/span> at \u003Cspan class=\"p-org\">University of Basel\u003C/span>, swimmer and swim coach.\u003C/p>\n\u003Cp>I am passionate about all things web development, swimming, personal knowledge management and much more.\nIf you liked this or any of my posts, feel free to \u003Ca href=\"https://tiim.ch/follow\" rel=\"nofollow noopener noreferrer\">follow me\u003C/a>.\u003C/p>",slug:"about",uuid:"d8e56802-2847-4053-b213-9b004f1b965c",date:new Date(1665792000000),created:new Date(1665863229652),published:true,abstract:"\u003Cp>Hi, my name is {{name}}!\nI'm a {{role}} at {{org}}, swimmer and swim coach.\u003C/p>",tags:[],links:void 0,type:"article",cover_image:void 0,description:"",folder:"metadata"}},"uses":{"params":["slug"]}}];

					Promise.all([
						import("../_app/immutable/entry/start.5c58580c.js"),
						import("../_app/immutable/entry/app.8dd63c07.js")
					]).then(([kit, app]) => {
						kit.start(app, element, {
							node_ids: [0, 4],
							data,
							form: null,
							error: null
						});
					});
				}
			</script>
		</div>
  </body>
</html>
